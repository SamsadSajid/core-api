<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>The encoding layer - Core API</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Core API</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Specification <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../document">The document layer</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">The encoding layer</a>
                            </li>
                        
                            <li >
                                <a href="../transport">The transport layer</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tools & resources <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../tools-and-resources/command-line-client">The command line client</a>
                            </li>
                        
                            <li >
                                <a href="../../tools-and-resources/example-services">Example services</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../document">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../transport">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/core-api/core-api/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#encoding">Encoding</a></li>
        
            <li><a href="#core-json">Core JSON</a></li>
        
            <li><a href="#hal">HAL</a></li>
        
            <li><a href="#json-hyper-schema">JSON Hyper-Schema</a></li>
        
            <li><a href="#openapi-swagger">OpenAPI / Swagger</a></li>
        
            <li><a href="#html">HTML</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="encoding">Encoding</h1>
<hr />
<p>The <strong>encoding layer</strong> defines the mapping between <a href="../document">the document layer</a>, and its byte string encoding.</p>
<p>Core API defines a canonical encoding scheme called Core JSON. Other encodings are also supported.</p>
<hr />
<h2 id="core-json">Core JSON</h2>
<p>Core JSON is a format that can be used to represent either Schema responses or Hypermedia response. It is designed to map cleanly to the Core API document model.</p>
<p>A document is represented using the <a href="http://www.json.org">JSON encoding</a>. In addition to the standard set of JSON primitives, Core JSON adds the following:</p>
<ul>
<li>Document. <code>{"_type": "document", ...}</code></li>
<li>Link. <code>{"_type": "link", ...}</code></li>
<li>Error. <code>{"_type": "error", ...}</code></li>
</ul>
<p>The top level element in a Core JSON response MUST either be a Document or an Error.</p>
<p>The media type for this scheme is: <code>application/vnd.coreapi+json</code>.</p>
<p>An example Core JSON encoded document is demonstrated below.</p>
<pre><code>{
    "_type": "document",
    "_meta": {
        "url": "/",
        "title": "Notes"
    },
    "notes": [
        {
            "_type": "document",
            "_meta": {
                "url": "/1de153fe-6747-41d3-bc0e-d9d7d87e448a",
                "title": "Note"
            },
            "complete": false,
            "description": "Email venue about conference dates",
            "delete": {
                "_type": "link",
                "action": "delete"
            },
            "edit": {
                "_type": "link",
                "action": "put",
                "fields": [
                    {
                        "name": "description"
                    }, {
                        "name": "complete"
                    }
                ]
            }
        }
    ],
    "add_note": {
        "_type": "link",
        "action": "post",
        "fields": [
            {
                "name": "description",
                "required": true
            }
        ]
    }
}
</code></pre>
<h3 id="document">Document</h3>
<p><strong>The Document primitive is represented using an object which includes a key-value pair of <code>"_type": "document"</code>.</strong></p>
<ul>
<li>
<p>Documents MAY include a <code>"_meta"</code> key. The value of this SHOULD be an object. If omitted, the default value is treated as an empty Object.</p>
</li>
<li>
<p>The <code>"_meta"</code> object MAY include keys named <code>"url"</code> and <code>"title"</code>.</p>
</li>
<li>
<p>Any other keys occurring in the Document <code>"_meta"</code> section SHOULD be ignored by clients.</p>
</li>
<li>
<p>The value of the <code>"url"</code> field SHOULD be a string. This value is treated as relative to the URL of any parent containing document. When a document is loaded from the network then the URL of the top level document is treated as relative to the URL that the content was fetched from. If omitted the default value is treated as the empty string, relative to the URL of the parent containing document or network URL, as above.</p>
</li>
<li>
<p>The value of the <code>"title"</code> field SHOULD be a string. If omitted, the default value is treated as the empty string.</p>
</li>
<li>
<p>All other key-value pairs are treated as the document content.</p>
</li>
</ul>
<h3 id="link">Link</h3>
<p><strong>The Link primitive is represented using an object which includes a key-value pair of <code>"_type": "link"</code>.</strong></p>
<ul>
<li>
<p>Links MAY include keys named <code>"url"</code>, <code>"action"</code>, <code>"transform"</code>, and <code>"fields"</code>.</p>
</li>
<li>
<p>Any other keys occurring in an Link SHOULD be ignored by clients.</p>
</li>
<li>
<p>The value of the <code>"url"</code> field SHOULD be a string, and is treated as relative to the URL of the parent containing document. If omitted the default value is treated as the empty string, relative to the URL of the parent containing document.</p>
</li>
<li>
<p>The value of the <code>"action"</code> field SHOULD be a string. If omitted value defaults to the empty string.</p>
</li>
<li>
<p>The value of the <code>"transform"</code> field SHOULD be a string. If omitted value defaults to the empty string.</p>
</li>
<li>
<p>The value of the <code>"fields"</code> field SHOULD be a list. If omitted the default value is the empty list.</p>
</li>
</ul>
<p><em>Link parameters:</em></p>
<ul>
<li>
<p>Each element of the <code>"fields"</code> list SHOULD be an object. Elements that are not objects are ignored.</p>
</li>
<li>
<p>An object item in the <code>"fields"</code> list SHOULD contain a key <code>"name"</code>. The value of this SHOULD be a string. If omitted, the object item is ignored.</p>
</li>
<li>
<p>An object item in the <code>"fields"</code> list MAY include a key <code>"required"</code>. The value of this SHOULD be a boolean. If omitted the default value is <code>false</code>.</p>
</li>
<li>
<p>An object item in the <code>"fields"</code> list MAY include a key <code>"location"</code>. The value of this SHOULD be a string. If omitted the default value is the empty string.</p>
</li>
</ul>
<h3 id="error">Error</h3>
<p><strong>The Error primitive is represented using an object which includes a key-value pair of <code>"_type": "error"</code>.</strong></p>
<ul>
<li>
<p>Error MAY include a <code>"_meta"</code> key. The value of this SHOULD be an object. If omitted, the default value is treated as an empty Object.</p>
</li>
<li>
<p>The <code>"_meta"</code> object MAY include a key named <code>"title"</code>.</p>
</li>
<li>
<p>Any other keys occurring in the Error <code>"_meta"</code> section SHOULD be ignored by clients.</p>
</li>
<li>
<p>The value of the <code>"title"</code> field SHOULD be a string. If omitted, the default value is treated as the empty string.</p>
</li>
<li>
<p>All other key-value pairs are treated as the error content.</p>
</li>
<li>
<p>Errors SHOULD only occur as the top level element. Any Error occurring as a child element inside a Document, Object or Array SHOULD be ignored.</p>
</li>
</ul>
<h3 id="data-primitives">Data primitives</h3>
<p><strong>The standard JSON primitives are represented as usual.</strong></p>
<ul>
<li>These are Object, Array, String, Integer, Number, <code>true</code>, <code>false</code> and <code>null</code>.</li>
</ul>
<h3 id="handling-unexpected-types">Handling unexpected types</h3>
<ul>
<li>
<p>Several of the Object structures described above indicate a required type for an element. When the value type is not as expected, the value SHOULD be ignored, and the indicated default value used instead.</p>
</li>
<li>
<p>Any Object with a <code>"_type"</code> key that is not <code>"document"</code>, <code>"link"</code> or <code>"error"</code> is invalid. The <code>"_type"</code> key and any <code>"_meta"</code> key are to be removed from the normal parse flow, and the element is to be treated by the client as a standard Object.</p>
</li>
</ul>
<h3 id="escaping-reserved-keys">Escaping reserved keys</h3>
<p>The object keys <code>"_type"</code> and <code>"_meta"</code> are reserved, and should not be included in the standard parsing of key-value contents of Document or Object types.</p>
<p>Core JSON ensures that the reserved <code>"_type"</code> and <code>"_meta"</code> are still valid literal keys, by providing escaping and unescaping rules as detailed below.</p>
<h4 id="escaping-reserved-keys-during-encoding">Escaping reserved keys during encoding</h4>
<p>When any object key matching the regular expression <code>/[\_]+(type|meta)/</code> is encountered, it MUST be escaped by pre-pending an additional underscore character.</p>
<h4 id="unescaping-reserved-keys-during-decoding">Unescaping reserved keys during decoding</h4>
<p>When any object key matching the regular expression <code>/_[\_]+(type|meta)/</code> is encountered, it MUST be unescaped by removing the leading underscore character.</p>
<h3 id="canonical-style">Canonical style</h3>
<p>The following canonical style indicates a set of guidelines that server implementations or client libraries MAY choose to follow, in order to generate a consistent output format for the JSON encoding.</p>
<h4 id="key-ordering">Key ordering</h4>
<p>Clients MAY choose to order any Object or Document keys in their output, as follows.</p>
<ul>
<li><code>"_type"</code></li>
<li><code>"_meta"</code> (With <code>"url"</code> occurring before <code>"title"</code> in the child Object.)</li>
<li>All keys with a value <em>that is not</em> a Link, ordered alphabetically.</li>
<li>All keys with a value <em>that is</em> a Link, ordered alphabetically.</li>
</ul>
<h4 id="omitting-default-values">Omitting default values</h4>
<p>Clients MAY choose to omit any values that are the default when encoding a document.</p>
<h4 id="using-relative-links">Using relative links</h4>
<p>Clients MAY take advantage of the relative URL transformations made when parsing Documents and Links, in order to encode minimal URL outputs.</p>
<ul>
<li>The top level Document MUST include its URL value, without transformation.</li>
<li>If a child Document or Link has the same scheme, host and port portion as its parent, it MAY omit those portions of the URL, and include only the path, query string and fragment identifier portion of the URL.</li>
<li>If a child Document or Link has the the same URL as its parent, it may omit the URL entirely.</li>
</ul>
<h4 id="indentation-and-spacing">Indentation and spacing</h4>
<p>Client MAY choose to use a concise style as the default. Using this style will ensure that no spacing or indentation is used between tokens.</p>
<p>Clients MAY choose to allow an optional verbose style. Using this style will ensure that ":" delimiters have a following whitespace, "," delimiters have no following whitespace, and elements are newline indented, with four space character indentation level.</p>
<hr />
<h2 id="hal">HAL</h2>
<p><em>HAL services MUST expose their endpoints with the <code>application/hal+json</code> media type.</em></p>
<p>Core API documents can be encoded in HAL, with a few limitations:</p>
<h4 id="hal-does-not-supports-parameter-or-action-information-on-links">HAL does not supports parameter or action information on links.</h4>
<p>When interacting with a HAL service using Core API, you'll need to explicitly
set any actions other than GET. For example, using the command line client:</p>
<pre><code>coreapi action add_note -a post -p description="A new todo note"
</code></pre>
<p>Additionally, parameters will not be included in the link descriptions displayed
by Core API documents.</p>
<h4 id="indexing-by-keys-vs-indexing-by-rel-values">Indexing by keys vs indexing by <code>rel</code> values.</h4>
<p>HAL uses <code>rel</code> values to identify and index links and embedded documents,
whereas Core API uses the key in the document.</p>
<p>In order to handle this Core API maps between HAL <code>rel</code> values and roughly equivalent key values.
For example, if decoding a HAL document then the link's <code>curie</code> name will be as the key, if it exists.</p>
<h4 id="valid-document-structures">Valid document structures.</h4>
<p>HAL supports documents and links as top level items, where Core API supports
documents and links nested anywhere in the parent document.</p>
<p>This introduces some limitations on the valid document structures that Core API
can support in HAL representations.</p>
<h4 id="link-help-information">Link help information.</h4>
<p>Core API does not yet support help information being associated with links,
which HAL provides for.</p>
<hr />
<h2 id="json-hyper-schema">JSON Hyper-Schema</h2>
<p><em>JSON Hyper-Schema endpoints MUST use the <code>application/schema+json</code> media type.</em></p>
<p>Core API can support decoding &amp; interacting with JSON HyperaSchema endpoints.</p>
<p>The schema style is less expressive that true hypermedia, as it consists of a single
monolithic entry point. Calls to the endpoint typically result in data being returned
from the service, rather than a new hypermedia document. Nonetheless, using a Core API
client library to interact with a service using its schema definition is far more robust
and meaningful than constructing HTTP requests explicitly.</p>
<p>The additional benefit of schemas is that they can be created for existing APIs without
any internal changes being required. Furthermore, if clients load the schema definition
from disk, then no initial HTTP call to request the entrypoint is required.</p>
<hr />
<h2 id="openapi-swagger">OpenAPI / Swagger</h2>
<p>Core API can support decoding &amp; interacting with OpenAPI / Swagger endpoints.</p>
<p>The following constraints currently exist, although future work is planned on each of these:</p>
<ul>
<li>Core API does not yet support file upload or download.</li>
<li>Core API does not yet support encodings other than JSON for request data.</li>
<li>Core API does not yet support choosing delimiters for lists in query parameters.</li>
<li>Core API does not yet support help information being associated with links.</li>
</ul>
<hr />
<h2 id="html">HTML</h2>
<p>Core API also allows servers to respond in a way that allows for direct Web browser
based interaction with the API.</p>
<p>By providing an HTML encoding, a service may expose either an API that can be interacted
with directly through the browser, or may expose HTML documentation pages, driven by
the information in the Core API document model.</p>
<p><img alt="HTML Encoding" src="../../../images/html-encoding.png" /></p>
<p><em>Above: An example of an API that can be interacted with in the browser.</em></p>
</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2015, <a href="https://twitter.com/_tomchristie">Tom Christie</a>.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>